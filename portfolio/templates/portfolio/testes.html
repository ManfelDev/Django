{% extends 'portfolio/base.html' %}

{% load static %}
{% block extra_styles %}
<link rel="stylesheet" href="{% static 'css_portfolio/sobre.css' %}">
{% endblock %}

{% block main %}
<section class="architecture-section">
    <h2>Test Types</h2>
    <div class="intro-text">
        <p>This application uses three main types of tests to ensure quality and stability:</p>
    </div>
    <div class="tech-list">
        <ul>
            <li><strong>Unit Tests:</strong> Validate individual methods or model behavior in isolation.</li>
            <li><strong>Integration Tests:</strong> Verify how different components (models, views, URLs) work together.</li>
            <li><strong>Template Tests:</strong> Ensure correct rendering of HTML pages and expected content.</li>
        </ul>
    </div>
</section>

<section class="architecture-section">
    <h3>Integration Tests Implemented</h3>
    <p>The following integration tests were implemented to verify the application's functionality:</p>
    
    <h4>ModelsTest</h4>
    <div class="tech-list">
        <ul>
            <li><strong>test_str_methods:</strong> Validates that the __str__ methods of all models (Projeto, Tecnologia, Disciplina, Docente) return the correct string representation</li>
            <li><strong>test_relationships:</strong> Verifies that model relationships work correctly, ensuring that projects have disciplines and technologies associated</li>
        </ul>
    </div>

    <h4>UrlsTest</h4>
    <div class="tech-list">
        <ul>
            <li><strong>test_projetos_url_resolves_to_correct_view:</strong> Confirms that the projects URL resolves to the correct view function</li>
            <li><strong>test_tecnologias_url_resolves_to_correct_view:</strong> Confirms that the technologies URL resolves to the correct view function</li>
        </ul>
    </div>

    <h4>ViewsTest</h4>
    <div class="tech-list">
        <ul>
            <li><strong>test_index_view_returns_200_and_uses_template:</strong> Verifies that the index page returns HTTP 200 and uses the correct template</li>
            <li><strong>test_projetos_view_returns_200_and_displays_projects:</strong> Ensures the projects page loads correctly and displays all project titles</li>
            <li><strong>test_tecnologias_view_returns_200_and_uses_template:</strong> Confirms the technologies page works properly and displays technology names</li>
        </ul>
    </div>
</section>

<section class="architecture-section">
    <h3>Example Test Implementation</h3>
    <p>Here's an example of one of the implemented tests:</p>
    <pre><code>def test_projetos_view_returns_200_and_displays_projects(self):
    response = self.client.get(reverse('portfolio:projetos'))
    self.assertEqual(response.status_code, 200)
    self.assertContains(response, 'My Projects')
    for projeto in Projeto.objects.all():
        self.assertContains(response, projeto.titulo)</code></pre>
    <p>This test verifies that the projects page loads successfully, contains the expected title, and displays all project names from the database.</p>
</section>

<section class="architecture-section">
    <h3>Test Results</h3>
    <p><strong>✅ All tests pass successfully.</strong> The test suite validates:</p>
    <div class="tech-list">
        <ul>
            <li>Model string representations and relationships</li>
            <li>URL routing and view resolution</li>
            <li>View responses and template rendering</li>
            <li>Content display and database integration</li>
        </ul>
    </div>
</section>

<section class="architecture-section">
    <h3>Coverage Report (using coverage module)</h3>
    <p>The tests achieved an overall coverage of <strong>75%</strong> using the coverage module. Key coverage details:</p>
    <div class="tech-list">
        <ul>
            <li><strong>portfolio.models:</strong> 100% coverage - All model methods and relationships tested</li>
            <li><strong>portfolio.forms:</strong> 100% coverage - Form validation and field handling verified</li>
            <li><strong>portfolio.tests:</strong> 100% coverage - Complete test suite execution</li>
            <li><strong>portfolio.views:</strong> 65% coverage - Core view logic tested, some edge cases remain</li>
            <li><strong>portfolio.urls:</strong> 90% coverage - Most URL patterns verified</li>
        </ul>
    </div>
    <p>The coverage module was used with the command: <code>coverage run --source='.' manage.py test && coverage report</code></p>
</section>

<section class="architecture-section">
    <h3>Selenium Functional Tests</h3>
    <div class="intro-text">
        <p>To validate the behavior of the application in a real browser environment, Selenium was used to simulate user interaction across different features of the site. Below are three recorded demonstrations with their corresponding test code:</p>
    </div>

    <div class="test-section">
        <h4>1. Navigation Test</h4>

        <iframe width="720" height="405"
                src="https://www.youtube.com/embed/gJgq0ctJkCU"
                title="Navigation Test"
                frameborder="0"
                allowfullscreen>
        </iframe>

        <div style="width: 100%; display: flex; flex-direction: column; align-items: center;">
            <p><strong>Test Steps:</strong></p>
            <div class="tech-list" style="text-align: left; display: inline-block;">
                <ul>
                    <li>Visit the homepage</li>
                    <li>Navigate through Architecture, Projects, Tools, and CV pages</li>
                    <li>Validate specific titles and content on each page</li>
                    <li>Verify page assertions for expected content</li>
                </ul>
            </div>
        </div>

        <p><strong>Navigation Test Code:</strong></p>
        <pre style="background-color: #2b2b2b; padding: 15px; border-radius: 8px; overflow-x: auto; margin-top: 10px;"><code>from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.common.by import By
import time

service = Service('C:/chromedriver/chromedriver.exe')
driver = webdriver.Chrome(service=service)

try:
    driver.get('https://a22202078.pw.deisi.ulusofona.pt/portfolio')
    time.sleep(2)

    driver.find_element(By.LINK_TEXT, "Architecture").click()
    time.sleep(2)
    assert "Technical Presentation" in driver.page_source

    driver.find_element(By.LINK_TEXT, "Projects").click()
    time.sleep(2)
    assert "My Projects" in driver.page_source

    driver.find_element(By.LINK_TEXT, "Tools").click()
    time.sleep(2)
    assert "Technologies Used" in driver.page_source

    driver.find_element(By.LINK_TEXT, "CV").click()
    time.sleep(2)
    assert "Curriculum Vitae" in driver.page_source

    print("✅ All navigation tests passed.")

finally:
    driver.quit()</code></pre>
    </div>

    <div class="test-section">
        <h4>2. Authentication Test</h4>

        <iframe width="720" height="405"
                src="https://www.youtube.com/embed/Nz7WF1F1rJc"
                title="Authentication Test"
                frameborder="0"
                allowfullscreen>
        </iframe>

        <div style="width: 100%; display: flex; flex-direction: column; align-items: center;">
            <p><strong>Test Steps:</strong></p>
            <div class="tech-list" style="text-align: left; display: inline-block;">
                <ul>
                    <li>Register a new user with random credentials</li>
                    <li>Login with the registered credentials</li>
                    <li>Create and publish a new article</li>
                    <li>Edit the created article</li>
                    <li>Delete the created article</li>
                    <li>Logout the user</li>
                </ul>
            </div>
        </div>

        <p><strong>Authentication Test Code:</strong></p>
        <pre style="background-color: #2b2b2b; padding: 15px; border-radius: 8px; overflow-x: auto; margin-top: 10px;"><code>from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.support.ui import Select, WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.by import By
import time
import random
import string
from datetime import date

service = Service('C:/chromedriver/chromedriver.exe')
driver = webdriver.Chrome(service=service)
wait = WebDriverWait(driver, 10)

# Generate random user data
random_suffix = ''.join(random.choices(string.ascii_lowercase + string.digits, k=6))
username = f"testuser_{random_suffix}"
email = f"{username}@test.com"
password = "TestPassword123!"

try:
    # Navigate and register
    driver.get("https://a22202078.pw.deisi.ulusofona.pt/portfolio")
    time.sleep(2)
    
    wait.until(EC.element_to_be_clickable((By.LINK_TEXT, "Login"))).click()
    wait.until(EC.element_to_be_clickable((By.LINK_TEXT, "Register"))).click()
    
    # Fill registration form
    wait.until(EC.presence_of_element_located((By.ID, "id_username"))).send_keys(username)
    driver.find_element(By.ID, "id_email").send_keys(email)
    driver.find_element(By.ID, "id_first_name").send_keys("Test")
    driver.find_element(By.ID, "id_last_name").send_keys("User")
    driver.find_element(By.ID, "id_password1").send_keys(password)
    driver.find_element(By.ID, "id_password2").send_keys(password)
    driver.find_element(By.CSS_SELECTOR, "form input[type='submit']").click()
    
    # Login
    wait.until(EC.presence_of_element_located((By.NAME, "username"))).send_keys(username)
    driver.find_element(By.NAME, "password").send_keys(password)
    driver.find_element(By.CSS_SELECTOR, "form input[type='submit']").click()
    
    # Create new post
    driver.get("https://a22202078.pw.deisi.ulusofona.pt/portfolio/posts/novo")
    
    # Fill post form
    author_select = wait.until(EC.presence_of_element_located((By.NAME, "autor")))
    select_autor = Select(author_select)
    select_autor.select_by_index(1)
    
    driver.find_element(By.ID, "id_titulo").send_keys("Selenium Test Post")
    driver.find_element(By.ID, "id_conteudo").send_keys("This is a test post created via Selenium.")
    
    # Submit and test post operations
    driver.find_element(By.CSS_SELECTOR, "form input[type='submit']").click()
    
    # Edit and delete post
    read_more_links = driver.find_elements(By.XPATH, "//a[contains(text(), 'Read more')]")
    read_more_links[0].click()
    
    edit_button = wait.until(EC.element_to_be_clickable((By.XPATH, "//a[contains(text(), 'Edit Post')]")))
    edit_button.click()
    
    delete_button = wait.until(EC.element_to_be_clickable((By.XPATH, "//a[contains(text(), 'Delete Post')]")))
    delete_button.click()
    
    # Logout
    driver.get("https://a22202078.pw.deisi.ulusofona.pt/portfolio/logout/")
    
    print("✅ All authentication tests passed.")
    
finally:
    driver.quit()</code></pre>
    </div>

    <div class="test-section">
        <h4>3. Project Lifecycle Test</h4>

        <iframe width="720" height="405"
                src="https://www.youtube.com/embed/xKmz-f8RR0g"
                title="Project Lifecycle Test"
                frameborder="0"
                allowfullscreen>
        </iframe>

        <div style="width: 100%; display: flex; flex-direction: column; align-items: center;">
            <p><strong>Test Steps:</strong></p>
            <div class="tech-list" style="text-align: left; display: inline-block;">
                <ul>
                    <li>Register a new user with random credentials</li>
                    <li>Login with the registered credentials</li>
                    <li>Create a new course project with full details</li>
                    <li>Edit the project's information and description</li>
                    <li>Delete the created project</li>
                    <li>Logout the user</li>
                </ul>
            </div>
        </div>

        <p><strong>Project Test Code:</strong></p>
        <pre style="background-color: #2b2b2b; padding: 15px; border-radius: 8px; overflow-x: auto; margin-top: 10px;"><code>from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.support.ui import Select, WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.by import By
import time
import random
import string

service = Service('C:/chromedriver/chromedriver.exe')
driver = webdriver.Chrome(service=service)
wait = WebDriverWait(driver, 10)

# Generate random user data
random_suffix = ''.join(random.choices(string.ascii_lowercase + string.digits, k=6))
username = f"testuser_{random_suffix}"
email = f"{username}@test.com"
password = "TestPassword123!"

try:
    # Navigate and register new user
    driver.get("https://a22202078.pw.deisi.ulusofona.pt/portfolio")
    time.sleep(2)
    
    wait.until(EC.element_to_be_clickable((By.LINK_TEXT, "Login"))).click()
    wait.until(EC.element_to_be_clickable((By.LINK_TEXT, "Register"))).click()
    
    # Fill registration form
    wait.until(EC.presence_of_element_located((By.ID, "id_username"))).send_keys(username)
    driver.find_element(By.ID, "id_email").send_keys(email)
    driver.find_element(By.ID, "id_first_name").send_keys("Test")
    driver.find_element(By.ID, "id_last_name").send_keys("User")
    driver.find_element(By.ID, "id_password1").send_keys(password)
    driver.find_element(By.ID, "id_password2").send_keys(password)
    driver.find_element(By.CSS_SELECTOR, "form input[type='submit']").click()
    
    # Login with credentials
    wait.until(EC.presence_of_element_located((By.NAME, "username"))).send_keys(username)
    driver.find_element(By.NAME, "password").send_keys(password)
    driver.find_element(By.CSS_SELECTOR, "form input[type='submit']").click()
    
    # Navigate to create new project
    driver.get("https://a22202078.pw.deisi.ulusofona.pt/portfolio/projetos/novo")
    
    # Fill project form with comprehensive data
    driver.find_element(By.ID, "id_titulo").send_keys("Sistema de Gestão de Biblioteca")
    driver.find_element(By.ID, "id_descricao").send_keys("Aplicação web desenvolvida em Django para gestão completa de uma biblioteca universitária.")
    driver.find_element(By.ID, "id_conceitos_aplicados").send_keys("Programação Orientada a Objetos, Padrão MVC, Base de Dados Relacionais")
    
    # Select discipline and technologies
    disciplina_select = wait.until(EC.presence_of_element_located((By.ID, "id_disciplina")))
    select_disciplina = Select(disciplina_select)
    select_disciplina.select_by_index(1)
    
    # Submit project creation
    driver.find_element(By.CSS_SELECTOR, "form input[type='submit']").click()
    
    # View and edit the created project
    view_details_links = driver.find_elements(By.XPATH, "//a[contains(text(), 'View Details')]")
    view_details_links[-1].click()
    
    edit_button = wait.until(EC.element_to_be_clickable((By.XPATH, "//a[contains(text(), 'Edit Project')]")))
    edit_button.click()
    
    # Edit project details
    titulo_field = driver.find_element(By.ID, "id_titulo")
    titulo_field.clear()
    titulo_field.send_keys("Sistema de Gestão de Biblioteca - Versão Atualizada")
    
    driver.find_element(By.CSS_SELECTOR, "form input[type='submit']").click()
    
    # Delete the project
    edit_button = wait.until(EC.element_to_be_clickable((By.XPATH, "//a[contains(text(), 'Edit Project')]")))
    edit_button.click()
    
    delete_button = wait.until(EC.element_to_be_clickable((By.XPATH, "//a[contains(text(), 'Delete Project')]")))
    delete_button.click()
    
    # Logout user
    driver.get("https://a22202078.pw.deisi.ulusofona.pt/portfolio/logout/")
    
    print("✅ All project tests passed.")

finally:
    driver.quit()</code></pre>
    </div>

    <p>These Selenium tests demonstrate comprehensive browser automation that validates the main user workflows of the application, ensuring that all features behave correctly under real usage scenarios.</p>
</section>
{% endblock %}